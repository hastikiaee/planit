<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="icon" href="../static/media/title.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Vazir&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link href="../static/css/admin_style.css" rel="stylesheet">
  <title>ูพูู ูุฏุฑุช ุขููุฒุด</title>
</head>
<body>
  <header>
    <img src="../static/media/logo.png" alt="ููฺฏู" class='logo'>
    <h1>ูพูู ูุฏุฑุช ุขููุฒุด</h1>
  </header>

  <!-- ุณูุฆฺ ุฏุงุฑฺฉ ููุฏ -->
  <div class="darkmode">
    <input type="checkbox" class="darkmode-checkbox" id="darkmode" />
    <label class="darkmode-label" for="darkmode">
      <i class="fas fa-moon"></i>
      <i class="fas fa-sun"></i>
      <div class="ball"></div>
    </label>
  </div>
  
  <!-- ููฺฏุดู ุจุงุฑ -->
  <nav id="nav">
    {% if full_name %}
      <div class="nav-buttons">
        <form action="{% url 'logout' %}" method="post">
          {% csrf_token %}
          <button type="submit">ุฎุฑูุฌ</button>
        </form>
        <button onclick="window.location.href='main'">ุตูุญู ุงุตู</button>
        <button onclick="switchTab('information')">ุงุทูุงุนุงุช ุฏุงูุดุฌูุงู ู ุงุณุงุชุฏ</button>
        <button onclick="switchTab('classification')">ุฌุฏูู ฺฉูุงุณโูุง</button>
        <button onclick="switchTab('confliction')">ุชุฏุงุฎูุงุช</button>
        <button onclick="switchTab('messages')">ูพุงูโูุง</button>
      </div>
      <p><span class="welcome">ุณูุงู </span>{{ full_name }}<spanid="admin_name"></span></p>
    {% else %}
      <div class="nav-buttons">
        <button onclick='{% url 'login' %}'>ุฎุฑูุฌ</button>
        <button onclick="switchTab('information')">ุงุทูุงุนุงุช ุฏุงูุดุฌูุงู ู ุงุณุงุชุฏ</button>
        <button onclick="switchTab('classification')">ุฌุฏูู ฺฉูุงุณโูุง</button>
        <button onclick="switchTab('confliction')">ุชุฏุงุฎูุงุช</button>
        <button onclick="switchTab('messages')">ูพุงูโูุง</button>
      </div>
    {% endif %}
    <button class="menu-toggle" onclick="toggleSidebar()">โฐ</button>
  </nav>
  <div id="spacer"></div>

  <!-- ุงุณูุงุฏ ุจุงุฑ -->
  <div class="sidebar" id="sidebar">
    <button class="sidebar-button" onclick="showSection('side_professors')">ูุฏุฑุช ุงุณุงุชุฏ</button>
    <button class="sidebar-button" onclick="showSection('side_faculty')">ุงุณุงุชุฏ ูุฏุฑ ฺฏุฑูู</button>
    <button class="sidebar-button" onclick="showSection('side_students')">ูุฏุฑุช ุฏุงูุดุฌูุงู</button>
    <button class="sidebar-button" onclick="showSection('side_schedule')">ฺุงุฑุช ุฏุฑูุณ</button>
    <button class="sidebar-button" onclick="showSection('side_examination')">ฺุงุฑุช ุงูุชุญุงูุงุช</button>
    <button class="sidebar-button" onclick="showSection('side_classes')">ูุฏุฑุช ฺฉูุงุณโูุง</button>
    <button class="sidebar-button" onclick="showSection('side_classification')">ุฌุฏูู ฺุงุฑุช ฺฉูุงุณ ุจูุฏ</button>
    <button class="sidebar-button" onclick="showSection('side_classification_chart')">ูุฏุฑุช ฺฉูุงุณ ุจูุฏ</button>
    <button class="sidebar-button" onclick="showSection('side_free_class')">ุงูุชู ฺฉูุงุณ ุขุฒุงุฏ</button>
    <button class="sidebar-button" onclick="showSection('side_confliction')">ุชุฏุงุฎูุงุช</button>
    <button class="sidebar-button" onclick="showSection('side_messages')">ูพุงูโูุง</button>
  </div>

  <div class="container">
    <!-- ูุฏุฑุช ุฏุฑูุณ -->
    <div id="side_courses" class="section">
      <div class="add-course-box">
        <h3>ุงุถุงูู ฺฉุฑุฏู ุฏุฑุณ</h3>
        <div class="form-section">
          <div>
            <!-- ุฑุดุชู ุฏุฑุณ -->
            <div>
              <label for="course_major">:ุฑุดุชู ุฏุฑุณ</label>
              <input type="text" id="course_major" class="time-box" placeholder="ุฑุดุชู ุฏุฑุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
          </div>
          <div>
            <!-- ููุน ุฏุฑุณ -->
            <div>
              <label for="course_type">:ููุน ุฏุฑุณ</label>
              <input type="text" id="course_type" placeholder="ููุน ุฏุฑุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
            <!-- ูุฏุช ฺฉูุงุณ -->
            <div>
              <label for="course_length">:ูุฏุช ฺฉูุงุณ</label>
              <input type="number" id="course_length" class="time-box" placeholder="ูุฏุช ฺฉูุงุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ" step="0.5" required>
            </div>
          </div>
          <div>
            <!-- ูุงู ุฏุฑุณ -->
            <div>
              <label for="course_name">:ูุงู ุฏุฑุณ</label>
              <input type="text" id="course_name" placeholder="ูุงู ุฏุฑุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
            <!-- ุชุนุฏุงุฏ ุฑูุฒ ุงุฑุงุฆู ุฏุฑุณ -->
            <div>
              <label for="course_days">:ุชุนุฏุงุฏ ุฑูุฒ ุงุฑุงุฆู</label>
              <input type="number" id="course_days" class="time-box" placeholder="ุชุนุฏุงุฏ ุฑูุฒ ุฑุง ูุงุฑุฏ ฺฉูุฏ" step="1" required>
            </div>
          </div>
        </div>
        <div class="button-container">
          <button onclick="addCourse()">ุงุถุงูู ฺฉุฑุฏู ุฏุฑุณ</button>
          <button id="importCoursesCSV">CSV ุขูพููุฏ ูุงู</button>
        </div>

        <!-- ุฌุฏูู ุงุทูุงุนุงุช ุฏุฑูุณ -->
        <table id="courses-table">
          <thead>
            <tr>
              <th>ุนููุงุช</th>
              <th>ูุฏุช ฺฉูุงุณ</th>
              <th>ุชุนุฏุงุฏ ุฑูุฒ ุงุฑุงุฆู</th>
              <th>ุฑุดุชู ุฏุฑุณ</th>
              <th>ููุน ุฏุฑุณ</th>
              <th>ูุงู ุฏุฑุณ</th>
            </tr>
            <tr id="empty-courses-table">              
              <td colspan="6" style="text-align:center; color: black;">!ูููุฒ ุฏุฑุณ ุงุถุงูู ูุดุฏู ุงุณุช</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <!-- ุฏุฑูุณ ุงูุฌุง ุงุถุงูู ูโุดููุฏ -->
            </tr>
          </tbody>
        </table>
        <div class="button-container">
          <button onclick="saveCourses()">ุฐุฎุฑู ุชุบุฑุงุช</button>
        </div>
      </div>
    </div>
    
    <!-- ูุฏุฑุช ุงุณุงุชุฏ -->
    <div id="side_professors" class="section">
      <div class="add-professor-box">
        <h3>ุงุถุงูู ฺฉุฑุฏู ุงุณุชุงุฏ</h3>
        <div class="form-section">
          <div>
            <!-- ุดูุงุฑู ุงุณุชุงุฏ -->
            <div>
              <label for="professor_number">:ุดูุงุฑู ุงุณุชุงุฏ</label>
              <input type="text" id="professor_number" placeholder="ุดูุงุฑู ุงุณุชุงุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
            <!-- ุฑุดุชู ุชุฏุฑุณ -->
            <div>
              <label for="professor_major">:ุฑุดุชู ุชุฏุฑุณ</label>
              <input type="text" id="professor_major" class="time-box" placeholder="ุฑุดุชู ุชุฏุฑุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
          </div>
          <div>
            <!-- ูุงู ุงุณุชุงุฏ -->
            <div>
              <label for="professor_name">:ูุงู ุงุณุชุงุฏ</label>
              <input type="text" id="professor_name" placeholder="ูุงู ุงุณุชุงุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>

            
            <!-- ุงูู ุงุณุชุงุฏ -->
            <div>
              <label for="professor_email">:ุงูู ุงุณุชุงุฏ</label>
              <input type="email" id="professor_email" class="time-box" placeholder="ุงูู ุงุณุชุงุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ" required>
            </div>
          </div>
           <!-- ููุฏ ุจููู -->
          <div>
            <label for="is_professor">ูุฏุฑ ฺฏุฑููุ</label>
            <input type="checkbox" id="is_professor">
          </div>
        </div>
        <div class="button-container">
          <button onclick="addProfessor()">ุงุถุงูู ฺฉุฑุฏู ุงุณุชุงุฏ</button>
          <button id="importProfessorsCSV">CSV ุขูพููุฏ ูุงู</button>
        </div>

        <!-- ุฌุฏูู ุงุทูุงุนุงุช ุงุณุงุชุฏ -->
        <div class="sort-professors">
          <label for="sort-select">ูุฑุชุจ ุณุงุฒ ุจุฑุงุณุงุณ: </label>
          <select id="sort-professors-select" class="sort-select">
            <option value="name">ูุงู ุงุณุชุงุฏ</option>
            <option value="major">ุฑุดุชู ุชุฏุฑุณ</option>
          </select>
        </div>
        <table id="professors-table">
          <thead>
            <tr>
              <th>ุนููุงุช</th>
              <th>ุฑุดุชู ุชุฏุฑุณ</th>
              <th>ุงูู ุงุณุชุงุฏ</th>
              <th>ุดูุงุฑู ุงุณุชุงุฏ</th>
              <th>ูุงู ุงุณุชุงุฏ</th>
            </tr>
            <tr id="empty-professors-table">              
              <td colspan="5" style="text-align:center; color: black;">!ูููุฒ ุงุณุชุงุฏ ุงุถุงูู ูุดุฏู ุงุณุช</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <!-- ุงุณุงุชุฏ ุงูุฌุง ุงุถุงูู ูโุดููุฏ -->
            </tr>
          </tbody>
        </table>
        <div class="button-container">
          <button onclick="saveProfessors()">ุฐุฎุฑู ุชุบุฑุงุช</button>
        </div>
      </div>
    </div>

    <!-- ุงุณุงุชุฏ ูุฏุฑ ฺฏุฑูู -->
    <div id="side_faculty" class="section">
      <div class="add-faculty-box">
        <h3>ุงุณุงุชุฏ ูุฏุฑ ฺฏุฑูู</h3>
        <div class="faculty-input-wrapper">
          <input id="professor-search-input" class="faculty-input" placeholder="ูุงู ุงุณุชุงุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ..." onkeyup="searchProfessor()">
          <button class="faculty-search-btn" onclick="searchProfessor()">ุฌุณุชุฌู</button>
        </div>
        <ul id="professor-suggestions" class="list-group suggestions-list shadow-sm"></ul>

        <!-- ุฌุฏูู ุงุทูุงุนุงุช ุงุณุงุชุฏ ูุฏุฑ ฺฏุฑูู -->
        <table id="faculty-table">
          <thead>
            <tr>
              <th>ุนููุงุช</th>
              <th>ุฑุดุชู ุชุฏุฑุณ</th>
              <th>ุงูู</th>
              <th>ุดูุงุฑู ุงุณุชุงุฏ</th>
              <th>ูุงู ุงุณุชุงุฏ</th>
            </tr>
            <tr id="empty-faculty-table">              
              <td colspan="5" style="text-align:center; color: black;">!ูููุฒ ุงุณุชุงุฏ ูุฏุฑฺฏุฑูู ุซุจุช ูุดุฏู ุงุณุช</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <!-- ุงุณุงุชุฏ ูุฏุฑ ฺฏุฑูู ุงูุฌุง ุงุถุงูู ูโุดููุฏ -->
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ูุฏุฑุช ุฏุงูุดุฌูุงู -->
    <div id="side_students" class="section">
      <div class="add-student-box">
        <h3>ุงุถุงูู ฺฉุฑุฏู ุฏุงูุดุฌู</h3>
        <div class="form-section">
          <div>
            <!-- ุงูู ุฏุงูุดุฌู -->
            <div>
              <label for="student_email">:ุงูู ุฏุงูุดุฌู</label>
              <input type="email" id="student_email" class="time-box" placeholder="ุงูู ุฏุงูุดุฌู ุฑุง ูุงุฑุฏ ฺฉูุฏ" required>
            </div>
          </div>
          <div>
            <!-- ุดูุงุฑู ุฏุงูุดุฌู -->
            <div>
              <label for="student_number">:ุดูุงุฑู ุฏุงูุดุฌู</label>
              <input type="text" id="student_number" placeholder="ุดูุงุฑู ุฏุงูุดุฌู ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
            <!-- ุณุงู ูุฑูุฏ -->
            <div>
              <label for="student_year">:ุณุงู ูุฑูุฏ</label>
              <input type="text" id="student_year" class="time-box" placeholder="ุณุงู ูุฑูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
          </div>
          <div>
            <!-- ูุงู ุฏุงูุดุฌู -->
            <div>
              <label for="student_name">:ูุงู ุฏุงูุดุฌู</label>
              <input type="text" id="student_name" placeholder="ูุงู ุฏุงูุดุฌู ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
            <!-- ุฑุดุชู ุชุญุตู -->
            <div>
              <label for="student_major">:ุฑุดุชู ุชุญุตู</label>
              <input type="text" id="student_major" class="time-box" placeholder="ุฑุดุชู ุชุญุตู ุฑุง ูุงุฑุฏ ฺฉูุฏ">
            </div>
          </div>
          <div>
            <label for="is_professor">ูุฏุฑ ฺฏุฑููุ</label>
            <input type="checkbox" id="is_professor">
          </div>
        </div>
        <div class="button-container">
          <button onclick="addStudent()">ุงุถุงูู ฺฉุฑุฏู ุฏุงูุดุฌู</button>
          <button id="importStudentsCSV">CSV ุขูพููุฏ ูุงู</button>
        </div>

        <!-- ุฌุฏูู ุงุทูุงุนุงุช ุฏุงูุดุฌูุงู -->
        <div class="sort-students">
          <label for="sort-select">ูุฑุชุจ ุณุงุฒ ุจุฑุงุณุงุณ: </label>
          <select id="sort-students-select" class="sort-select">
            <option value="name">ูุงู ุฏุงูุดุฌู</option>
            <option value="number">ุดูุงุฑู ุฏุงูุดุฌู</option>
            <option value="major">ุฑุดุชู ุชุญุตู</option>
            <option value="year">ุณุงู ูุฑูุฏ</option>
          </select>
        </div>
        <table id="students-table">
          <thead>
            <tr>
              <th>ุนููุงุช</th>
              <th>ุณุงู ูุฑูุฏ</th>
              <th>ุฑุดุชู ุชุญุตู</th>
              <th>ุงูู ุฏุงูุดุฌู</th>
              <th>ุดูุงุฑู ุฏุงูุดุฌู</th>
              <th>ูุงู ุฏุงูุดุฌู</th>
            </tr>
            <tr id="empty-students-table">              
              <td colspan="6" style="text-align:center; color: black;">!ูููุฒ ุฏุงูุดุฌู ุงุถุงูู ูุดุฏู ุงุณุช</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <!-- ุฏุงูุดุฌูุงู ุงูุฌุง ุงุถุงูู ูโุดููุฏ -->
            </tr>
          </tbody>
        </table>
        <div class="button-container">
          <button onclick="saveStudents()">ุฐุฎุฑู ุชุบุฑุงุช</button>
          <button onclick="exportStudents()">ุฏุงูููุฏ ุฎุฑูุฌ</button>
        </div>
      </div>
    </div>

    <!-- ุฌุฏูู ฺุงุฑุช ุฏุฑูุณ -->
    <div id="side_schedule" class="section">
      <!-- ููุชุฑฺฉุฑุฏู ฺุงุฑุช ุฏุฑูุณ -->
      <div class="sort-schedule">
        <div>
          <label for="sort-select">ููุชุฑฺฉุฑุฏู ุจุฑุงุณุงุณ ูุฑูุฏ: </label>
          <select id="sort-entry-select" class="sort-select">
            <option value="all-entry">ููู ูุฑูุฏ ูุง</option>
            <option value="first">ูุฑูุฏ ุงูู</option>
            <option value="second">ูุฑูุฏ ุฏูู</option>
            <option value="third">ูุฑูุฏ ุณูู</option>
            <option value="forth">ูุฑูุฏ ฺูุงุฑู</option>
          </select>
        </div>
        <div>
          <label for="sort-select">ููุชุฑฺฉุฑุฏู ุจุฑุงุณุงุณ ุฑุดุชู: </label>
          <select id="sort-major-select" class="sort-select">
            <option value="all-major">ููู ุฑุดุชู ูุง</option>
            <option value="computer">ูููุฏุณ ฺฉุงููพูุชุฑ</option>
            <option value="industrial">ูููุฏุณ ุตูุงุน</option>
            <option value="chemical">ูููุฏุณ ุดู</option>
            <option value="petroleum">ูููุฏุณ ููุช</option>
          </select>
        </div>
      </div>
      <table class="schedule-table">
        <thead>
          <tr>
            <th>ุฑูุฒูุง</th>
            <th>ูุฑูุฏ</th>
            <th>ุฑุดุชู ุชุญุตู</th>
            <th>08:00 08:30</th>
            <th>08:30 09:00</th>
            <th>09:00 09:30</th>
            <th>09:30 10:00</th>
            <th>10:00 10:30</th>
            <th>10:30 11:00</th>
            <th>11:00 11:30</th>
            <th>11:30 12:00</th>
            <th>12:00 12:30</th>
            <th>12:30 13:00</th>
            <th>13:00 13:30</th>
            <th>13:30 14:00</th>
            <th>14:00 14:30</th>
            <th>14:30 15:00</th>
            <th>15:00 15:30</th>
            <th>15:30 16:00</th>
            <th>16:00 16:30</th>
            <th>16:30 17:00</th>
            <th>17:00 17:30</th>
            <th>17:30 18:00</th>
          </tr>
        </thead>
        <tbody>
          <script>
            const days = ["ุดูุจู", "ฺฉุดูุจู", "ุฏูุดูุจู", "ุณูโุดูุจู", "ฺูุงุฑุดูุจู", "ูพูุฌโุดูุจู"];
            const groups = ["ูุฑูุฏ ุงูู", "ูุฑูุฏ ุฏูู", "ูุฑูุฏ ุณูู", "ูุฑูุฏ ฺูุงุฑู"];
            const majors = ["ูููุฏุณ ฺฉุงููพูุชุฑ", "ูููุฏุณ ุตูุงุน", "ูููุฏุณ ุดู", "ูููุฏุณ ููุช"];
          
            const pad = n => n.toString().padStart(2, "0");
          
            days.forEach((day, dayIndex) => {
              document.write(`<tr><td rowspan="${groups.length * majors.length}">${day}</td>`);
          
              groups.forEach((group, groupIndex) => {
                majors.forEach((major, majorIndex) => {
                  if (groupIndex > 0 || majorIndex > 0) document.write(`<tr>`);
          
                  if (majorIndex === 0) {
                    document.write(`<td rowspan="${majors.length}">${group}</td>`);
                  }
          
                  document.write(`<td>${major}</td>`);
          
                  for (let i = 8; i < 18; i += 0.5) {
                    const startHour = Math.floor(i);
                    const startMin = i % 1 === 0 ? "00" : "30";
                    const endHour = startMin === "00" ? startHour : startHour + 1;
                    const endMin = startMin === "00" ? "30" : "00";
                    const timeId = `day${dayIndex}-group${groupIndex}-major${majorIndex}-${pad(startHour)}:${startMin}-${pad(endHour)}:${endMin}`;
                    document.write(`<td class="time-block" id="${timeId}"></td>`);
                  }
          
                  document.write(`</tr>`);
                });
              });
            });
          </script>
        </tbody>
      </table>
    </div>

    <!-- ุฌุฏูู ฺุงุฑุช ุงูุชุญุงูุงุช -->
    <div id="side_examination" class="section">
      <!-- ููุชุฑฺฉุฑุฏู ฺุงุฑุช ุงูุชุญุงูุงุช -->
      <div class="sort-schedule">
        <div>
          <label for="sort-select">ููุชุฑฺฉุฑุฏู ุจุฑุงุณุงุณ ูุฑูุฏ: </label>
          <select id="sort-exam-entry-select" class="sort-select">
            <option value="exam-all-entry">ููู ูุฑูุฏ ูุง</option>
            <option value="exam-first">ูุฑูุฏ ุงูู</option>
            <option value="exam-second">ูุฑูุฏ ุฏูู</option>
            <option value="exam-third">ูุฑูุฏ ุณูู</option>
            <option value="exam-forth">ูุฑูุฏ ฺูุงุฑู</option>
          </select>
        </div>
        <div>
          <label for="sort-select">ููุชุฑฺฉุฑุฏู ุจุฑุงุณุงุณ ุฑุดุชู: </label>
          <select id="sort-exam-major-select" class="sort-select">
            <option value="exam-all-major">ููู ุฑุดุชู ูุง</option>
            <option value="exam-computer">ูููุฏุณ ฺฉุงููพูุชุฑ</option>
            <option value="exam-industrial">ูููุฏุณ ุตูุงุน</option>
            <option value="exam-chemical">ูููุฏุณ ุดู</option>
            <option value="exam-petroleum">ูููุฏุณ ููุช</option>
          </select>
        </div>
      </div>
      <table class="examination-table" id="examsTable">
        <thead>
            <tr>
                <th>ุฑูุฒ ููุชู</th>
                <th>ุชุงุฑุฎ ุงูุชุญุงู</th>
                <th>ุฒูุงู ุงูุชุญุงู</th>
                <th>ูุฑูุฏ</th>
                <th>ุฑุดุชู</th>
                <th>ูุงู ุงุณุชุงุฏ</th>
                <th>ููุน ุฏุฑุณ</th>
                <th>ูุงู ุฏุฑุณ</th>
            </tr>
        </thead>
        <tbody>
          <script>
            class jDate {
              constructor(year, month, day) {
                this.year = parseInt(year);
                this.month = parseInt(month);
                this.day = parseInt(day);
              }
              toGregorian() {
                let g = jalaliToGregorian(this.year, this.month, this.day);
                return new Date(g.gy, g.gm - 1, g.gd);
              }
              static fromGregorian(date) {
                let gYear = date.getFullYear();
                let gMonth = date.getMonth() + 1;
                let gDay = date.getDate();
                let j = gregorianToJalali(gYear, gMonth, gDay);
                return new jDate(j.jy, j.jm, j.jd);
              }
              addDays(n) {
                let gDate = this.toGregorian();
                gDate.setDate(gDate.getDate() + n);
                return jDate.fromGregorian(gDate);
              }
              isBeforeOrEqual(other) {
                if(this.year < other.year) return true;
                if(this.year > other.year) return false;
                if(this.month < other.month) return true;
                if(this.month > other.month) return false;
                return this.day <= other.day;
              }
              toString() {
                return `${this.year}/${String(this.month).padStart(2,'0')}/${String(this.day).padStart(2,'0')}`;
              }
              getWeekday() {
                let gDate = this.toGregorian();
                return gDate.toLocaleDateString('fa-IR', { weekday: 'long' });
              }
            }
            function getExamDates(startStr, endStr) {
              let examDays = [];
          
              function parseJalali(str) {
                let parts = str.split('/');
                return new jDate(parts[0], parts[1], parts[2]);
              }
          
              let start = parseJalali(startStr);
              let end = parseJalali(endStr);
          
              let current = start;
              while(current.isBeforeOrEqual(end)) {
                let weekday = current.getWeekday();
                if (weekday !== "ุฌูุนู") {
                  examDays.push({ day: weekday, date: current.toString() });
                }
                current = current.addDays(1);
              }
              return examDays;
            }
            const examTimes = ["09:00-11:00", "09:00-11:00", "13:30-15:30", "13:30-15:30"];
            function renderExamTable() {
              const startDate = document.getElementById('start_date').value.trim();
              const endDate = document.getElementById('end_date').value.trim();
          
              if (!startDate || !endDate) {
                alert("ูุทูุง ุชุงุฑุฎ ุดุฑูุน ู ูพุงุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ");
                return;
              }
          
              let examDays;
              try {
                examDays = getExamDates(startDate, endDate);
              } catch {
                alert("ูุฑูุช ุชุงุฑุฎโูุง ุจุงุฏ ุจู ุดฺฉู yyyy/mm/dd ุจุงุดุฏ.");
                return;
              }
          
              const tbody = document.querySelector("#examsTable tbody");
              tbody.innerHTML = ""; 
          
              examDays.forEach(({ day, date }) => {
                examTimes.forEach((time, index) => {
                  const tr = document.createElement('tr');
                  if(index === 0) {
                    const tdDay = document.createElement('td');
                    tdDay.rowSpan = 4;
                    tdDay.textContent = day;
                    tr.appendChild(tdDay);
          
                    const tdDate = document.createElement('td');
                    tdDate.rowSpan = 4;
                    tdDate.textContent = date;
                    tr.appendChild(tdDate);
                  }
          
                  const tdTime = document.createElement('td');
                  tdTime.textContent = time;
                  tr.appendChild(tdTime);
          
                  for(let i=0; i<5; i++) {
                    const tdEmpty = document.createElement('td');
                    tr.appendChild(tdEmpty);
                  }
          
                  tbody.appendChild(tr);
                });
              });
            }
            renderExamTable();
          </script>
        </tbody>
      </table>
    </div>

    <!-- ุจุฑูุงูู ฺฉูุงุณุจูุฏ -->
    <div id="classification" class="tab-content active">
      <!-- ุฌุฏูู ฺุงุฑุช ฺฉูุงุณ ุจูุฏ -->
      <div id="side_classification" class="section">
        <table class="classification-table" border="1">
          <thead>
            <tr>
              <th>ุฑูุฒูุง</th>
              <th>08:00 08:30</th>
              <th>08:30 09:00</th>
              <th>09:00 09:30</th>
              <th>09:30 10:00</th>
              <th>10:00 10:30</th>
              <th>10:30 11:00</th>
              <th>11:00 11:30</th>
              <th>11:30 12:00</th>
              <th>12:00 12:30</th>
              <th>12:30 13:00</th>
              <th>13:00 13:30</th>
              <th>13:30 14:00</th>
              <th>14:00 14:30</th>
              <th>14:30 15:00</th>
              <th>15:00 15:30</th>
              <th>15:30 16:00</th>
              <th>16:00 16:30</th>
              <th>16:30 17:00</th>
              <th>17:00 17:30</th>
              <th>17:30 18:00</th>
            </tr>
          </thead>
          <tbody id="classification-table-body">
          
          </tbody>
        </table>
      </div>

      <!-- ุจุฎุด ุงุถุงูู ฺฉุฑุฏู ฺฉูุงุณ -->
      <div id="side_classes" class="section">
        <div class="add-class-box">
          <h3>ุงุถุงูู ฺฉุฑุฏู ฺฉูุงุณ</h3>
          <div class="form-section">
            <div>
              <!-- ุธุฑูุช ฺฉูุงุณ -->
              <div>
                <label for="class_capacity">:ุธุฑูุช ฺฉูุงุณ</label>
                <input type="number" id="class_capacity" class="time-box" placeholder="ุธุฑูุช ฺฉูุงุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
              </div>
            </div>
            <div>
              <!-- ููุน ฺฉูุงุณ -->
              <div>
                <label for="class_type">:ููุน ฺฉูุงุณ</label>
                <select id="class_type">
                  <option value="ฺฉูุงุณ ุฏุฑุณ">ฺฉูุงุณ ุฏุฑุณ</option>
                  <option value="ุขุฒูุงุดฺฏุงู">ุขุฒูุงุดฺฏุงู</option>
                  <option value="ฺฉุงุฑฺฏุงู">ฺฉุงุฑฺฏุงู</option>
                  <option value="ุขูู ุชุฆุงุชุฑ">ุขูู ุชุฆุงุชุฑ</option>
                  <option value="ูุฑุฒุดฺฏุงู">ูุฑุฒุดฺฏุงู</option>
                </select>
              </div>
              <!-- ุทุจูู ฺฉูุงุณ -->
              <div>
                <label for="class_floor">:ุทุจูู ฺฉูุงุณ</label>
                <input type="number" id="class_floor" class="time-box" placeholder="ุทุจูู ฺฉูุงุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ" required>
              </div>
            </div>
            <div>
              <!-- ูุงู ฺฉูุงุณ -->
              <div>
                <label for="class_name">:ูุงู ฺฉูุงุณ</label>
                <input type="text" id="class_name" placeholder="ูุงู ฺฉูุงุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
              </div>
              <!-- ุณุงุฎุชูุงู ฺฉูุงุณ -->
              <div>
                <label for="class_building">:ุณุงุฎุชูุงู ฺฉูุงุณ</label>
                <input type="text" id="class_building" class="time-box" placeholder="ุณุงุฎุชูุงู ฺฉูุงุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ" step="1" required>
              </div>
            </div>
          </div>
          <div class="button-container">
            <button onclick="addClass()">ุงุถุงูู ฺฉุฑุฏู ฺฉูุงุณ</button>
            <button id="importClassesCSV">CSV ุขูพููุฏ ูุงู</button>
          </div>

          <!-- ุฌุฏูู ุงุทูุงุนุงุช ฺฉูุงุณโูุง -->
          <table id="classes-table">
            <thead>
              <tr>
                <th>ุนููุงุช</th>
                <th>ุทุจูู ฺฉูุงุณ</th>
                <th>ุณุงุฎุชูุงู ฺฉูุงุณ</th>
                <th>ุธุฑูุช ฺฉูุงุณ</th>
                <th>ููุน ฺฉูุงุณ</th>
                <th>ูุงู ฺฉูุงุณ</th>
              </tr>
              <tr id="empty-classes-table">              
                <td colspan="6" style="text-align:center; color: black;">!ูููุฒ ฺฉูุงุณ ุงุถุงูู ูุดุฏู ุงุณุช</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <!-- ฺฉูุงุณโูุง ุงูุฌุง ุงุถุงูู ูโุดููุฏ -->
              </tr>
            </tbody>
          </table>
          <div class="button-container">
            <button onclick="saveClasses()">ุฐุฎุฑู ุชุบุฑุงุช</button>
          </div>
        </div>
        <!-- ุณุงุฎุชู ุจุฑูุงูู -->
        <div class="button-finish">
          <button id="generate-classification" onclick="generateClassification()">ุณุงุฎุชู ุจุฑูุงูู ฺฉูุงุณ</button>
        </div>
      </div>

      <!-- ูุฏุฑุช ฺุงุฑุช ฺฉูุงุณ ุจูุฏ -->
      <div id="side_classification_chart" class="section">
        <div class="add-classification-box">
          <h3>ูุฏุฑุช ฺุงุฑุช ฺฉูุงุณุจูุฏ</h3>
          <!-- ูุฑุชุจ ุณุงุฒ ุงุทูุงุนุงุช ฺุงุฑุช -->
          <div class="sort-classification">
            <label for="sort-select">ูุฑุชุจ ุณุงุฒ ุจุฑุงุณุงุณ: </label>
            <select id="sort-classification-select" class="sort-select">
              <option value="day">ุฑูุฒ ููุชู</option>
              <option value="professor">ูุงู ุงุณุชุงุฏ</option>
              <option value="class">ูุงู ฺฉูุงุณ</option>
              <option value="subject">ูุงู ุฏุฑุณ</option>
            </select>
          </div>
          <!-- ุฌุฏูู ุงุทูุงุนุงุช ฺุงุฑุช -->
          <table id="classification-chart-table">
            <thead>
              <tr>
                <th>ุนููุงุช</th>
                <th>ุฒูุงู ูพุงุงู</th>
                <th>ุฒูุงู ุดุฑูุน</th>
                <th>ุฑูุฒ ููุชู</th>
                <th>ูุงู ฺฉูุงุณ</th>
                <th>ูุงู ุงุณุชุงุฏ</th>
                <th>ูุงู ุฏุฑุณ</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <!-- ุงุทูุงุนุงุช ฺุงุฑุช ุงูุฌุง ุงุถุงูู ูโุดููุฏ -->
              </tr>
            </tbody>
          </table>
          <div class="button-container">
            <button onclick="saveClassification()">ุฐุฎุฑู ุชุบุฑุงุช</button>
          </div>
        </div>
      </div>

      <!-- ุงูุชู ฺฉูุงุณ ุขุฒุงุฏ -->
      <div id="side_free_class" class="section">
        <div class="add-find-class-box">
          <h3>ุงูุชู ฺฉูุงุณ ุขุฒุงุฏ</h3>
          <!-- ุงุทูุงุนุงุช ฺฉูุงุณ ูุฏูุธุฑ -->
          <div class="form-section">
            <div>
              <!-- ุธุฑูุช ฺฉูุงุณ -->
              <div>
                <label for="target-capacity">:ุธุฑูุช ููุฑุฏูุงุฒ</label>
                <input type="number" id="target-capacity" min="1" value="30">
              </div>
            </div>
            <div>
              <!-- ุฑูุฒ ููุชู -->
              <div>
                <label for="target-day">:ุฑูุฒ ููุชู</label>
                <select id="target-day" class="time-box">
                  <option>ุดูุจู</option>
                  <option>ฺฉุดูุจู</option>
                  <option>ุฏูุดูุจู</option>
                  <option>ุณูโุดูุจู</option>
                  <option>ฺูุงุฑุดูุจู</option>
                  <option>ูพูุฌโุดูุจู</option>
                </select>
              </div>
            </div>
          </div>
          <div class="button-container">
            <button onclick="findClass()">ุงูุชู ฺฉูุงุณ</button>
          </div>
          <!-- ุฌุฏูู ุงุทูุงุนุงุช ฺุงุฑุช -->
          <table id="find-class-table">
            <thead>
              <tr>
                <th>ุจุงุฒู ุณูู</th>
                <th>ุจุงุฒู ุฏูู</th>
                <th>ุจุงุฒู ุงูู</th>
                <th>ุฑูุฒ ููุชู</th>
                <th>ุธุฑูุช ฺฉูุงุณ</th>
                <th>ูุงู ฺฉูุงุณ</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <!-- ุงุทูุงุนุงุช ฺฉูุงุณ ุงูุฌุง ุงุถุงูู ูโุดููุฏ -->
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ุงุถุงูู ฺฉุฑุฏู ุชุฏุงุฎูุงุช -->
    <div id="side_confliction" class="section">
      <!-- ุจุฎุด ุงุถุงูู ฺฉุฑุฏู ุชุฏุงุฎูุงุช -->
      <div class="add-conflict-box">
        <h3>ุงุถุงูู ฺฉุฑุฏู ุชุฏุงุฎู</h3>
        <div class="form-section">
          <!-- ุชุฏุงุฎู ุฏุฑุณ ุง ุงูุชุญุงู -->
          <div>
            <label for="conflict_type">:ููุน ุชุฏุงุฎู</label>
            <select id="conflict_type" class="time-box">
                <option value="ุฏุฑุณ">ุฏุฑุณ</option>
                <option value="ุงูุชุญุงู">ุงูุชุญุงู</option>
            </select>
          </div>
          <!-- ุฑูุฒ ุชุฏุงุฎู -->
          <div>
            <label for="conflict_days">:ุฑูุฒ ุชุฏุงุฎู</label>
            <select id="conflict_days" class="time-box">
              <option value="ุดูุจู">ุดูุจู</option>
              <option value="ฺฉุดูุจู">ฺฉุดูุจู</option>
              <option value="ุฏูุดูุจู">ุฏูุดูุจู</option>
              <option value="ุณูโุดูุจู">ุณูโุดูุจู</option>
              <option value="ฺูุงุฑุดูุจู">ฺูุงุฑุดูุจู</option>
              <option value="ูพูุฌโุดูุจู">ูพูุฌโุดูุจู</option>
              <option value="ูุฑ ุฏูุฑูุฒ">ูุฑ ุฏู ุฑูุฒ</option>
            </select>
          </div>
          <!-- ุฏุฑุณ ุฏูู -->
          <div>
            <label for="conflict_subject_two">:ุฏุฑุณ ุฏูู</label>
            <select id="conflict_subject_two" class="time-box">
              {% for subject in subject_list %}
                <option value="{{ subject }}">{{ subject }}</option>
              {% endfor %}
            </select>
          </div>
          <!-- ุฏุฑุณ ุงูู -->
          <div>
            <label for="conflict_subject_one">:ุฏุฑุณ ุงูู</label>
            <select id="conflict_subject_one" class="time-box">
              {% for subject in subject_list %}
                <option value="{{ subject }}">{{ subject }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="button-container" onclick="addConflict()">
          <button>ุงุถุงูู ฺฉุฑุฏู ุชุฏุงุฎู</button>
        </div>

        <!-- ุฌุฏูู ุชุฏุงุฎูุงุช -->
        <table id="conflicts-table">
          <thead>
            <tr>
              <th>ุนููุงุช</th>
              <th>ูุถุนุช ุจุฑุทุฑู ุดุฏู</th>
              <th>ููุน ุชุฏุงุฎู</th>
              <th>ุฑูุฒ ุชุฏุงุฎู</th>
              <th>ุฏุฑุณ ุฏูู</th>
              <th>ุฏุฑุณ ุงูู</th>
            </tr>
            <tr id="empty-conflicts-table">              
              <td colspan="6" style="text-align:center; color: black;">!ูููุฒ ุชุฏุงุฎู ุซุจุช ูุดุฏู ุงุณุช</td>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
        <div class="button-container">
          <button onclick="saveConflicts()">ุฐุฎุฑู ุชุบุฑุงุช</button>
        </div>
      </div>
    </div>

    <!-- ูพุงูโูุง -->
    <div class="add-message-box">
      <h3>ูพุงูโูุง ุฏุฑุงูุช</h3>
      <div class="messages-wrapper">
        <!-- ฺุช ุฎุตูุต -->
        <div id="side_private" class="section">
          {% if full_name %}
            <div class="chat-container" id="chatContainer" style="display: block;">
                <div class="chat-header"></div>
                <div class="chat-box" id="private">
                    <!-- ูพุงูโูุง ุงูุฌุง ุงุถุงูู ูโุดููุฏ -->
                </div>
                <div class="chat-input">
                    <div id="pickerContainer">
                      <button id="togglePickerBtn" style="font-size: 21px; padding-top: 3px; padding-bottom: 4px;">๐</button>
                      <div id="emojiPicker"></div>
                    </div>
                    <input type="text" id="messageInputPrivate" style="font-size: 18px; padding-top: 3px; padding-bottom: 3px;" placeholder="ูพุงู ุฎูุฏ ุฑุง ุจููุณุฏ...">
                    <button onclick="sendPrivateMessage()">ุงุฑุณุงู</button>
                </div>
            </div>
          {% endif %}
        </div>
        
        <div id="side_messages" class="section">
          <!-- ุฌุณุชุฌู ุงุณุชุงุฏ -->
          <div class="professor-input-wrapper">
            <input id="professor-search-message" class="professor-input" placeholder="ูุงู ุงุณุชุงุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ..." onkeyup="messageProfessor()">
            <button class="professor-search-btn" onclick="messageProfessor()">ุฌุณุชุฌู</button>
          </div>
          <ul id="professor-suggestions-message" class="list-group suggestions-list shadow-sm"></ul>
          <div id="contacts-list"><!-- ูุฎุงุทุจู ุงูุฌุง ุงุถุงูู ูโุดููุฏ --></div>
        </div>
      </div>
    </div>
  </div>
</body>
<script>
  let adminName = "{{ full_name }}";
</script>
<script src="../static/js/admin_script.js"></script>
<script type="module">
  import { createPicker } from 'https://cdn.skypack.dev/picmo';

  const pickerContainer = document.getElementById('emojiPicker');
  const toggleBtn = document.getElementById('togglePickerBtn');
  const messageInput = document.getElementById('messageInputPrivate');

  const picker = createPicker({ rootElement: pickerContainer });

  pickerContainer.style.display = 'none';

  toggleBtn.addEventListener('click', () => {
    if (pickerContainer.style.display === 'none') {
      pickerContainer.style.display = 'block';
    } else {
      pickerContainer.style.display = 'none';
    }
  });

  picker.addEventListener('emoji:select', event => {
    messageInput.value += event.emoji;
    messageInput.focus();
  });
</script>
</html>
